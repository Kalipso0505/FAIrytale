{
    "openapi": "3.1.0",
    "info": {
        "title": "Laravel",
        "version": "0.0.1"
    },
    "servers": [
        {
            "url": "http://localhost/api"
        }
    ],
    "tags": [
        {
            "name": "Game"
        },
        {
            "name": "Debug (intern)"
        },
        {
            "name": "AI-Service (intern)"
        }
    ],
    "paths": {
        "/prompts": {
            "get": {
                "operationId": "listPromptTemplates",
                "description": "Gibt alle verf\u00fcgbaren Prompt-Templates mit Key, Name und Body zur\u00fcck.",
                "summary": "Alle Prompt-Templates auflisten",
                "tags": [
                    "AI-Service (intern)"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "prompts": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/components/schemas/PromptTemplate"
                                            }
                                        }
                                    },
                                    "required": [
                                        "prompts"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/prompts/all": {
            "get": {
                "operationId": "getAllPromptsMap",
                "description": "Optimierter Endpunkt f\u00fcr den AI-Service. Gibt alle Prompts\nals einfaches Key\u2192Body Dictionary zur\u00fcck.",
                "summary": "Alle Prompts als Key-Body-Map",
                "tags": [
                    "AI-Service (intern)"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "additionalProperties": {}
                                }
                            }
                        }
                    }
                }
            }
        },
        "/prompts/{key}": {
            "get": {
                "operationId": "getPromptTemplate",
                "description": "Gibt ein Prompt-Template anhand seines eindeutigen Keys zur\u00fcck.",
                "summary": "Einzelnes Prompt-Template abrufen",
                "tags": [
                    "AI-Service (intern)"
                ],
                "parameters": [
                    {
                        "name": "key",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "key": {
                                            "type": "string"
                                        },
                                        "name": {
                                            "type": "string"
                                        },
                                        "body": {
                                            "type": "string"
                                        },
                                        "updated_at": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "key",
                                        "name",
                                        "body",
                                        "updated_at"
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "enum": [
                                                "Prompt template not found"
                                            ]
                                        },
                                        "key": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "error",
                                        "key"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/debug/personas": {
            "get": {
                "operationId": "getDebugPersonas",
                "description": "Debug-Endpunkt zum Abrufen aller Persona-Informationen vom AI-Service.",
                "summary": "Alle Personas mit vollst\u00e4ndigem Wissen abrufen",
                "tags": [
                    "Debug (intern)"
                ],
                "responses": {
                    "500": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "enum": [
                                                "Failed to load personas from AI service"
                                            ]
                                        },
                                        "message": {
                                            "type": "string"
                                        },
                                        "personas": {
                                            "type": "array",
                                            "items": {
                                                "type": "string"
                                            },
                                            "minItems": 0,
                                            "maxItems": 0,
                                            "additionalItems": false
                                        }
                                    },
                                    "required": [
                                        "error",
                                        "message",
                                        "personas"
                                    ]
                                }
                            }
                        }
                    },
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                }
            }
        },
        "/game/generate-and-start": {
            "post": {
                "operationId": "game.generate-and-start",
                "summary": "Generate a new scenario and start game",
                "tags": [
                    "Game"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "user_input": {
                                        "type": [
                                            "string",
                                            "null"
                                        ],
                                        "maxLength": 500
                                    },
                                    "difficulty": {
                                        "type": "string",
                                        "enum": [
                                            "einfach",
                                            "mittel",
                                            "schwer"
                                        ]
                                    }
                                },
                                "required": [
                                    "difficulty"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "500": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "enum": [
                                                "Szenario-Generierung fehlgeschlagen"
                                            ]
                                        },
                                        "details": {
                                            "type": [
                                                "string",
                                                "null"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "error",
                                        "details"
                                    ]
                                }
                            }
                        }
                    },
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "game_id": {
                                            "type": "string"
                                        },
                                        "scenario_name": {},
                                        "setting": {},
                                        "victim": {},
                                        "personas": {},
                                        "intro_message": {}
                                    },
                                    "required": [
                                        "game_id",
                                        "scenario_name",
                                        "setting",
                                        "victim",
                                        "personas",
                                        "intro_message"
                                    ]
                                }
                            }
                        }
                    },
                    "422": {
                        "$ref": "#/components/responses/ValidationException"
                    }
                }
            }
        },
        "/game/start": {
            "post": {
                "operationId": "game.start",
                "summary": "Start a new game",
                "tags": [
                    "Game"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "game_id": {
                                            "type": "string"
                                        },
                                        "scenario_name": {
                                            "type": "string",
                                            "enum": [
                                                "Der Fall InnoTech"
                                            ]
                                        },
                                        "setting": {
                                            "type": "string",
                                            "enum": [
                                                "Die InnoTech GmbH ist ein aufstrebendes Tech-Startup in M\u00fcnchen.",
                                                ""
                                            ]
                                        },
                                        "victim": {
                                            "type": "string",
                                            "enum": [
                                                "Marcus Weber (CFO)"
                                            ]
                                        },
                                        "personas": {
                                            "type": "array",
                                            "prefixItems": [
                                                {
                                                    "type": "object",
                                                    "properties": {
                                                        "slug": {
                                                            "type": "string",
                                                            "enum": [
                                                                "elena"
                                                            ]
                                                        },
                                                        "name": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Elena Schmidt"
                                                            ]
                                                        },
                                                        "role": {
                                                            "type": "string",
                                                            "enum": [
                                                                "CEO"
                                                            ]
                                                        },
                                                        "description": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Die Gr\u00fcnderin und CEO von InnoTech. Professionell, ehrgeizig, kontrolliert."
                                                            ]
                                                        },
                                                        "emoji": {
                                                            "type": "string",
                                                            "enum": [
                                                                "\ud83c\udfe2"
                                                            ]
                                                        },
                                                        "image": {
                                                            "type": "string",
                                                            "enum": [
                                                                "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop&crop=faces&q=80"
                                                            ]
                                                        }
                                                    },
                                                    "required": [
                                                        "slug",
                                                        "name",
                                                        "role",
                                                        "description",
                                                        "emoji",
                                                        "image"
                                                    ]
                                                },
                                                {
                                                    "type": "object",
                                                    "properties": {
                                                        "slug": {
                                                            "type": "string",
                                                            "enum": [
                                                                "tom"
                                                            ]
                                                        },
                                                        "name": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Tom Berger"
                                                            ]
                                                        },
                                                        "role": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Lead Developer"
                                                            ]
                                                        },
                                                        "description": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Der technische Kopf des Startups. Introvertiert, brillant, manchmal nerv\u00f6s."
                                                            ]
                                                        },
                                                        "emoji": {
                                                            "type": "string",
                                                            "enum": [
                                                                "\ud83d\udcbb"
                                                            ]
                                                        },
                                                        "image": {
                                                            "type": "string",
                                                            "enum": [
                                                                "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop&crop=faces&q=80"
                                                            ]
                                                        }
                                                    },
                                                    "required": [
                                                        "slug",
                                                        "name",
                                                        "role",
                                                        "description",
                                                        "emoji",
                                                        "image"
                                                    ]
                                                },
                                                {
                                                    "type": "object",
                                                    "properties": {
                                                        "slug": {
                                                            "type": "string",
                                                            "enum": [
                                                                "lisa"
                                                            ]
                                                        },
                                                        "name": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Lisa Hoffmann"
                                                            ]
                                                        },
                                                        "role": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Executive Assistant"
                                                            ]
                                                        },
                                                        "description": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Die langj\u00e4hrige Assistentin. Loyal, aufmerksam, diskret."
                                                            ]
                                                        },
                                                        "emoji": {
                                                            "type": "string",
                                                            "enum": [
                                                                "\ud83d\udccb"
                                                            ]
                                                        },
                                                        "image": {
                                                            "type": "string",
                                                            "enum": [
                                                                "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=faces&q=80"
                                                            ]
                                                        }
                                                    },
                                                    "required": [
                                                        "slug",
                                                        "name",
                                                        "role",
                                                        "description",
                                                        "emoji",
                                                        "image"
                                                    ]
                                                },
                                                {
                                                    "type": "object",
                                                    "properties": {
                                                        "slug": {
                                                            "type": "string",
                                                            "enum": [
                                                                "klaus"
                                                            ]
                                                        },
                                                        "name": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Klaus M\u00fcller"
                                                            ]
                                                        },
                                                        "role": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Facility Manager"
                                                            ]
                                                        },
                                                        "description": {
                                                            "type": "string",
                                                            "enum": [
                                                                "Der erfahrene Hausmeister. Ruhig, beobachtend, kennt alle Ecken."
                                                            ]
                                                        },
                                                        "emoji": {
                                                            "type": "string",
                                                            "enum": [
                                                                "\ud83d\udd27"
                                                            ]
                                                        },
                                                        "image": {
                                                            "type": "string",
                                                            "enum": [
                                                                "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=faces&q=80"
                                                            ]
                                                        }
                                                    },
                                                    "required": [
                                                        "slug",
                                                        "name",
                                                        "role",
                                                        "description",
                                                        "emoji",
                                                        "image"
                                                    ]
                                                }
                                            ],
                                            "minItems": 4,
                                            "maxItems": 4,
                                            "additionalItems": false
                                        },
                                        "intro_message": {
                                            "type": "string",
                                            "enum": [
                                                "Willkommen beim Fall \"InnoTech\". Marcus Weber, CFO der InnoTech GmbH, wurde tot aufgefunden. Befrage die Verd\u00e4chtigen und l\u00f6se den Fall!"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "game_id",
                                        "scenario_name",
                                        "setting",
                                        "victim",
                                        "personas",
                                        "intro_message"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/game/chat": {
            "post": {
                "operationId": "game.chat",
                "summary": "Send a chat message",
                "tags": [
                    "Game"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "game_id": {
                                        "type": "string",
                                        "format": "uuid"
                                    },
                                    "persona_slug": {
                                        "type": "string"
                                    },
                                    "message": {
                                        "type": "string",
                                        "maxLength": 1000
                                    }
                                },
                                "required": [
                                    "game_id",
                                    "persona_slug",
                                    "message"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "503": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "enum": [
                                                "AI Service nicht erreichbar. Bitte versuche es sp\u00e4ter erneut."
                                            ]
                                        },
                                        "details": {
                                            "type": [
                                                "string",
                                                "null"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "error",
                                        "details"
                                    ]
                                }
                            }
                        }
                    },
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "persona_slug": {},
                                        "persona_name": {},
                                        "response": {},
                                        "revealed_clue": {}
                                    },
                                    "required": [
                                        "persona_slug",
                                        "persona_name",
                                        "response",
                                        "revealed_clue"
                                    ]
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "enum": [
                                                "Game is not active"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "error"
                                    ]
                                }
                            }
                        }
                    },
                    "422": {
                        "$ref": "#/components/responses/ValidationException"
                    }
                }
            }
        },
        "/game/{gameId}/history": {
            "get": {
                "operationId": "game.history",
                "summary": "Get chat history for a game",
                "tags": [
                    "Game"
                ],
                "parameters": [
                    {
                        "name": "gameId",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "game_id": {
                                            "type": "string"
                                        },
                                        "status": {
                                            "type": "string"
                                        },
                                        "revealed_clues": {
                                            "anyOf": [
                                                {
                                                    "type": "string"
                                                },
                                                {
                                                    "type": "array",
                                                    "items": {
                                                        "type": "string"
                                                    },
                                                    "minItems": 0,
                                                    "maxItems": 0,
                                                    "additionalItems": false
                                                }
                                            ]
                                        },
                                        "messages": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "game_id",
                                        "status",
                                        "revealed_clues",
                                        "messages"
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/components/responses/ModelNotFoundException"
                    }
                }
            }
        },
        "/game/accuse": {
            "post": {
                "operationId": "game.accuse",
                "summary": "Accuse a persona",
                "tags": [
                    "Game"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "game_id": {
                                        "type": "string",
                                        "format": "uuid"
                                    },
                                    "accused_persona": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "game_id",
                                    "accused_persona"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "correct": {
                                            "type": "boolean"
                                        },
                                        "message": {
                                            "type": "string",
                                            "enum": [
                                                "Richtig! Du hast den Fall gel\u00f6st!",
                                                "Falsch! Das war nicht der M\u00f6rder."
                                            ]
                                        }
                                    },
                                    "required": [
                                        "correct",
                                        "message"
                                    ]
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "error": {
                                            "type": "string",
                                            "enum": [
                                                "Game is not active"
                                            ]
                                        }
                                    },
                                    "required": [
                                        "error"
                                    ]
                                }
                            }
                        }
                    },
                    "422": {
                        "$ref": "#/components/responses/ValidationException"
                    }
                }
            }
        }
    },
    "components": {
        "schemas": {
            "PromptTemplate": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "integer"
                    },
                    "key": {
                        "type": "string"
                    },
                    "name": {
                        "type": "string"
                    },
                    "body": {
                        "type": "string"
                    },
                    "created_at": {
                        "type": [
                            "string",
                            "null"
                        ],
                        "format": "date-time"
                    },
                    "updated_at": {
                        "type": [
                            "string",
                            "null"
                        ],
                        "format": "date-time"
                    }
                },
                "required": [
                    "id",
                    "key",
                    "name",
                    "body",
                    "created_at",
                    "updated_at"
                ],
                "title": "PromptTemplate"
            }
        },
        "responses": {
            "ValidationException": {
                "description": "Validation error",
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "message": {
                                    "type": "string",
                                    "description": "Errors overview."
                                },
                                "errors": {
                                    "type": "object",
                                    "description": "A detailed description of each field that failed validation.",
                                    "additionalProperties": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        }
                                    }
                                }
                            },
                            "required": [
                                "message",
                                "errors"
                            ]
                        }
                    }
                }
            },
            "ModelNotFoundException": {
                "description": "Not found",
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "message": {
                                    "type": "string",
                                    "description": "Error overview."
                                }
                            },
                            "required": [
                                "message"
                            ]
                        }
                    }
                }
            }
        }
    }
}